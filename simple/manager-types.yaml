node_types:

  manager.nodes.PythonHost:
    derived_from: cloudify.nodes.SoftwareComponent
    properties:
      pip_version:
        type: string
        default: { get_input: pip_version }
      virtualenv_version:
        type: string
        default: { get_input: virtualenv_version }
    interfaces:
      cloudify.interfaces.lifecycle:
        create: components/python/scripts/create.sh

  manager.nodes.JavaHost:
    derived_from: cloudify.nodes.SoftwareComponent
    interfaces:
      cloudify.interfaces.lifecycle:
        create: components/java/scripts/create.sh

  manager.nodes.RabbitMQ:
    derived_from: cloudify.nodes.MessageBusServer
    properties:
      erlang_rpm_source_url:
        type: string
        default: { get_input: erlang_source_url }
      rabbitmq_rpm_source_url:
        type: string
        default: { get_input: rabbitmq_source_url }
    interfaces:
      cloudify.interfaces.lifecycle:
        create: components/rabbitmq/scripts/create.sh
        start: components/rabbitmq/scripts/start.sh
        stop: components/rabbitmq/scripts/stop.sh

  manager.nodes.Elasticsearch:
    derived_from: cloudify.nodes.DBMS
    properties:
      elasticsearch_tar_source_url:
        description: Elasticsearch Source URL
        type: string
        default: { get_input: elasticsearch_source_url }
      port:
        description: Elasticsearch API Port
        type: integer
        default: { get_input: elasticsearch_port }
      discovery_port:
        description: Elasticsearch Zen Discovery Port
        type: integer
        default: { get_input: elasticsearch_discovery_port }
      es_java_opts:
        description: ES_JAVA_OPTS Env Var
        type: string
        default: { get_input: elasticsearch_java_opts }
    interfaces:
      cloudify.interfaces.lifecycle:
        create: components/elasticsearch/scripts/create.sh
        start: components/elasticsearch/scripts/start.sh
        stop: components/elasticsearch/scripts/stop.sh

  manager.nodes.Logstash:
    derived_from: cloudify.nodes.SoftwareComponent
    properties:
      logstash_tar_source_url:
        description: >
          You can provide a url to a different Logstash tar.
          This will allow you to switch versions.
        type: string
        default: { get_input: logstash_source_url }
    interfaces:
      cloudify.interfaces.lifecycle:
        create: components/logstash/scripts/create.sh
        start: components/logstash/scripts/start.sh
        stop: components/logstash/scripts/stop.sh

  manager.nodes.InfluxDB:
    derived_from: cloudify.nodes.DBMS
    properties:
      influxdb_rpm_source_url:
        description: InfluxDB Source URL
        type: string
        default: { get_input: influxdb_source_url }
      port:
        description: InfluxDB API Port
        type: integer
        default: { get_input: influxdb_port }
    interfaces:
      cloudify.interfaces.lifecycle:
        create: components/influxdb/scripts/create.sh
        start: components/influxdb/scripts/start.sh
        stop: components/influxdb/scripts/stop.sh

  manager.nodes.Nginx:
    derived_from: cloudify.nodes.WebServer
    properties:
      rest_service_module_source_url:
        description: REST Service repo tar URL for resources
        type: string
        default: { get_input: rest_service_source_url }
      # should also have a source_url for nginx.
      # currently it seems that they don't directly provide
      # an rpm for us to download, we'll have to fix that :)
    interfaces:
      cloudify.interfaces.lifecycle:
        create: components/frontend/scripts/create.sh
        start: components/frontend/scripts/start.sh
        stop: components/frontend/scripts/stop.sh

  manager.nodes.Riemann:
    derived_from: cloudify.nodes.SoftwareComponent
    properties:
      langohr_jar_source_url:
        description: Langohr JAR Source URL
        type: string
        default: { get_input: langohr_source_url }
      daemonize_rpm_source_url:
        description: Daemonize RPM Source URL
        type: string
        default: { get_input: daemonize_source_url }
      riemann_rpm_source_url:
        description: Riemann RPM Source URL
        type: string
        default: { get_input: riemann_source_url }
    interfaces:
      cloudify.interfaces.lifecycle:
        create: components/riemann/scripts/create.sh
        start: components/riemann/scripts/start.sh
        stop: components/riemann/scripts/stop.sh

  manager.nodes.RestService:
    derived_from: cloudify.nodes.ApplicationModule
    properties:
      dsl_parser_module_source_url:
        description: DSL Parser module Source URL
        type: string
        default: { get_input: dsl_parser_source_url }
      rest_client_module_source_url:
        description: REST Client module Source URL
        type: string
        default: { get_input: rest_client_source_url }
      plugins_common_module_source_url:
        description: Plugins Common module Source URL
        type: string
        default: { get_input: plugins_common_source_url }
      securest_module_source_url:
        description: Flask SecuREST module Source URL
        type: string
        default: { get_input: securest_source_url }
      rest_service_module_source_url:
        description: REST Service module Source URL
        type: string
        default: { get_input: rest_service_source_url }
    interfaces:
      cloudify.interfaces.lifecycle:
        create: components/restservice/scripts/create.sh
        start: components/restservice/scripts/start.sh
        stop: components/restservice/scripts/stop.sh

  manager.nodes.ManagementWorker:
    derived_from: cloudify.nodes.ApplicationModule
    interfaces:
      cloudify.interfaces.lifecycle:
        create: components/mgmtworker/scripts/create.sh
        start: components/mgmtworker/scripts/start.sh
        stop: components/mgmtworker/scripts/stop.sh

  manager.nodes.AmqpInfluxBroker:
    derived_from: cloudify.nodes.ApplicationModule
    interfaces:
      cloudify.interfaces.lifecycle:
        create: components/amqpinflux/scripts/create.sh
        start: components/amqpinflux/scripts/start.sh
        stop: components/amqpinflux/scripts/stop.sh

  manager.nodes.FileServer:
    derived_from: cloudify.nodes.ApplicationServer

relationships:

  # logstash is installed
  # logstash config file is deployed
  # elasticsearch host and port are retrieved
  # elasticsearch host and port are inserted to logstash config
  # logstash is started
  logstash_connected_to_elasticsearch:
    derived_from: cloudify.relationships.connected_to
    target_interfaces:
      cloudify.interfaces.relationship_lifecycle:
        postconfigure: components/logstash/scripts/set-ls-es-host-and-port.sh

  logstash_connected_to_rabbitmq:
    derived_from: cloudify.relationships.connected_to
    target_interfaces:
      cloudify.interfaces.relationship_lifecycle:
        postconfigure: components/logstash

  contained_in_java_host:
    derived_from: cloudify.relationships.contained_in
    target_interfaces:
      cloudify.interfaces.relationship_lifecycle:
        preconfigure:

  restservice_connected_to_elasticsearch:

  nginx_connected_to_restservice:

  nginx_connected_to_ui:

  riemann_connected_to_rabbbitmq:

  amqpinflux_connected_to_rabbitmq:

  amqpinflux_connected_to_influxdb:

  restservice_connected_to_rabbitmq:

