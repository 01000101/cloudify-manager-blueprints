node_types:

  manager.nodes.PythonHost:
    derived_from: cloudify.nodes.SoftwareComponent
    properties:
      pip_version:
        type: string
        default: { get_input: pip_version }
      virtualenv_version:
        type: string
        default: { get_input: virtualenv_version }
    interfaces:
      cloudify.interfaces.lifecycle:
        create: components/python/scripts/create.sh

  manager.nodes.JavaHost:
    derived_from: cloudify.nodes.SoftwareComponent
    interfaces:
      cloudify.interfaces.lifecycle:
        create: components/java/scripts/create.sh

  manager.nodes.RabbitMQ:
    derived_from: cloudify.nodes.MessageBusServer
    properties:
      erlang_rpm_source_url:
        type: string
        default: { get_input: erlang_source_url }
      rabbitmq_rpm_source_url:
        type: string
        default: { get_input: rabbitmq_source_url }
    interfaces:
      cloudify.interfaces.lifecycle:
        create: components/rabbitmq/scripts/create.sh
        start: components/rabbitmq/scripts/start.sh

  manager.nodes.Elasticsearch:
    derived_from: cloudify.nodes.DBMS
    properties:
      elasticsearch_tar_source_url:
        description: Elasticsearch Source URL
        type: string
        default: { get_input: elasticsearch_source_url }
      port:
        description: Elasticsearch API Port
        type: integer
        default: { get_input: elasticsearch_port }
      discovery_port:
        description: Elasticsearch Zen Discovery Port
        type: integer
        default: { get_input: elasticsearch_discovery_port }
      es_java_opts:
        description: ES_JAVA_OPTS Env Var
        type: string
        default: { get_input: elasticsearch_java_opts }
    interfaces:
      cloudify.interfaces.lifecycle:
        create: components/elasticsearch/scripts/create.sh
        start: components/elasticsearch/scripts/start.sh

  manager.nodes.Logstash:
    derived_from: cloudify.nodes.SoftwareComponent
    properties:
      logstash_tar_source_url:
        description: >
          You can provide a url to a different Logstash tar.
          This will allow you to switch versions.
        type: string
        default: { get_input: logstash_source_url }
    interfaces:
      cloudify.interfaces.lifecycle:
        create: components/logstash/scripts/create.sh
        start: components/logstash/scripts/start.sh

  manager.nodes.InfluxDB:
    derived_from: cloudify.nodes.DBMS
    properties:
      influxdb_rpm_source_url:
        description: InfluxDB Source URL
        type: string
        default: { get_input: influxdb_source_url }
      port:
        description: InfluxDB API Port
        type: integer
        default: { get_input: influxdb_port }
    interfaces:
      cloudify.interfaces.lifecycle:
        create: components/influxdb/scripts/create.sh
        start: components/influxdb/scripts/start.sh

  manager.nodes.Nginx:
    derived_from: cloudify.nodes.WebServer
    properties:
      rest_service_module_source_url:
        description: REST Service repo tar URL for resources
        type: string
        default: { get_input: rest_service_source_url }
      # should also have a source_url for nginx.
      # currently it seems that they don't directly provide
      # an rpm for us to download, we'll have to fix that :)
    interfaces:
      cloudify.interfaces.lifecycle:
        create: components/frontend/scripts/create.sh
        start: components/frontend/scripts/start.sh

  manager.nodes.Riemann:
    derived_from: cloudify.nodes.SoftwareComponent
    properties:
      langohr_jar_source_url:
        description: Langohr JAR Source URL
        type: string
        default: { get_input: langohr_source_url }
      daemonize_rpm_source_url:
        description: Daemonize RPM Source URL
        type: string
        default: { get_input: daemonize_source_url }
      riemann_rpm_source_url:
        description: Riemann RPM Source URL
        type: string
        default: { get_input: riemann_source_url }
    interfaces:
      cloudify.interfaces.lifecycle:
        create: components/riemann/scripts/create.sh
        start: components/riemann/scripts/start.sh

  manager.nodes.RestService:
    derived_from: cloudify.nodes.ApplicationModule
    properties:
      dsl_parser_module_source_url:
        description: DSL Parser module Source URL
        type: string
        default: { get_input: dsl_parser_source_url }
      rest_client_module_source_url:
        description: REST Client module Source URL
        type: string
        default: { get_input: rest_client_source_url }
      plugins_common_module_source_url:
        description: Plugins Common module Source URL
        type: string
        default: { get_input: plugins_common_source_url }
      securest_module_source_url:
        description: Flask SecuREST module Source URL
        type: string
        default: { get_input: securest_source_url }
      rest_service_module_source_url:
        description: REST Service module Source URL
        type: string
        default: { get_input: rest_service_source_url }
      gunicorn_workers:
        description: Number of workers Gunicorn loads up with
        type: integer
        default: { get_input: gunicorn_workers }
    interfaces:
      cloudify.interfaces.lifecycle:
        create: components/restservice/scripts/create.sh
        start: components/restservice/scripts/start.sh

  manager.nodes.ManagementWorker:
    derived_from: cloudify.nodes.ApplicationModule
    properties:
      celery_version:
        description: Celery version to use
        type: string
        default: 3.1.17
      rest_client_module_source_url:
        description: REST Client module Source URL
        type: string
        default: { get_input: rest_client_source_url }
      plugins_common_module_source_url:
        description: Plugins Common module Source URL
        type: string
        default: { get_input: plugins_common_source_url }
      script_plugin_source_url:
        description: Script Plugin module Source URL
        type: string
        default: { get_input: securest_source_url }
      rest_service_module_source_url:
        description: REST Service module Source URL
        type: string
        default: { get_input: rest_service_source_url }
    interfaces:
      cloudify.interfaces.lifecycle:
        create: components/mgmtworker/scripts/create.sh
        start: components/mgmtworker/scripts/start.sh

  manager.nodes.AmqpInfluxBroker:
    derived_from: cloudify.nodes.ApplicationModule
    properties:
      amqpinflux_module_source_url:
        description: AMQP to InfluxDB Broker Source URL
        type: string
        default: { get_input: amqpinflux_source_url }
    interfaces:
      cloudify.interfaces.lifecycle:
        create: components/amqpinflux/scripts/create.sh
        start: components/amqpinflux/scripts/start.sh

  manager.nodes.WebUI:
    derived_from: cloudify.nodes.ApplicationModule
    properties:
      webui_tar_source_url:
        description: Cloudify's WebUI Source URL
        type: string
        default: { get_input: webui_source_url }
      grafana_tar_source_url:
        description: Cloudify's Grafana Source URL
        type: string
        default: { get_input: grafana_source_url }
      nodejs_tar_source_url:
        description: NodeJS tgz Source URL
        type: string
        default: { get_input: nodejs_source_url }
      webui_backend_port:
        description: Port to the WebUI's backend
        type: integer
        default: { get_input: webui_backend_port }
    interfaces:
      cloudify.interfaces.lifecycle:
        create: components/webui/scripts/create.sh
        start: components/webui/scripts/start.sh



######################################################################
# The relationships don't provide any configuration related
# functionality but are rather here just to provide the dependency
# graph. Host configuration for all components assumes "localhost"
######################################################################
relationships:

  logstash_to_elasticsearch:
    derived_from: cloudify.relationships.connected_to

  logstash_to_rabbitmq:
    derived_from: cloudify.relationships.connected_to

  restservice_to_elasticsearch:
    derived_from: cloudify.relationships.connected_to

  nginx_to_restservice:
    derived_from: cloudify.relationships.connected_to

  nginx_to_webui:
    derived_from: cloudify.relationships.connected_to

  riemann_to_rabbitmq:
    derived_from: cloudify.relationships.connected_to

  riemann_to_nginx:
    derived_from: cloudify.relationships.connected_to

  mgmtworker_to_rabbitmq:
    derived_from: cloudify.relationships.connected_to

  mgmtworker_to_nginx:
    derived_from: cloudify.relationships.connected_to

  amqpinflux_to_rabbitmq:
    derived_from: cloudify.relationships.connected_to

  amqpinflux_to_influxdb:
    derived_from: cloudify.relationships.connected_to

  restservice_to_rabbitmq:
    derived_from: cloudify.relationships.connected_to

  webui_to_influxdb:
    derived_from: cloudify.relationships.connected_to